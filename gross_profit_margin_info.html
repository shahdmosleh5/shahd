
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="website icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/2657/2657051.png">

    <title>Gross profit ratio analysis</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="css_analysis.css">


</head>
<body>
    <div class="container">
        <a href="excel.html" class="back-btn">⬅ Back</a>
        <h1 class="text-center">Gross Profit Analysis</h1>
        <div class="canvas-container">
            <canvas id="financialChart"></canvas>
        </div>
        <div class="analysis-section">
            <h3>Performance Analysis of Gross Profit compared to previous years </h3>
            <div id="performanceMessage" class="mt-3"></div>
        </div>
        <div class="canvas-container">
            <canvas id="differenceChart"></canvas>
        </div>
        <div class="analysis-section">
            <h3>The change resulted from either revenues or from COGS.</h3>
            <div id="differenceMessage" class="mt-3"></div>
        </div>
        <!-- Third chart for Revenue - COGS difference over time -->
        <div class="canvas-container">
            <canvas id="revenueCOGSChart"></canvas>
        </div>
        <div class="analysis-section">
            <h3>Revenue vs. COGS Difference Over Time</h3>
            <div id="revenueCOGSMessage" class="mt-3"></div>
        </div>

        <!-- قسم التعليقات للمدير والمستثمر -->
        <div class="analysis-section">
            <h3>Advice and Guidance for Understanding Financial Analysis</h3>
            <div id="managerInvestorComments" class="mt-3"></div>
        </div>

        <div class="text-center mt-4">
            <button class="btn btn-custom" onclick="downloadPDF()">Download Full Report</button>
        </div>
        <div class="footer">
            <p>Need help? <a href="Financial Statements Analysis Made Easy.html">Contact Support</a></p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script>
        // نسبة الربح الإجمالي
        const grossProfitMargin = [30, 22, parseFloat(localStorage.getItem('grossProfitMargin2023')) || 28];

        // إعداد الرسم البياني الأول (الربح الإجمالي)
        const ctx = document.getElementById('financialChart').getContext('2d');
        const financialChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['2021', '2022', '2023'],
                datasets: [{
                    label: 'Gross Profit Margin (%)',
                    data: grossProfitMargin,
                    borderColor: '#00c3ff',
                    backgroundColor: 'rgba(0, 195, 255, 0.2)',
                    borderWidth: 3,
                    pointRadius: 5,
                    pointBackgroundColor: '#00c3ff'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: true, position: 'top', labels: { color: '#fff' } },
                    tooltip: {
                        backgroundColor: '#333',
                        titleColor: '#00c3ff',
                        bodyColor: '#fff',
                        borderWidth: 1,
                        borderColor: '#00c3ff'
                    }
                },
                scales: {
                    x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#fff' } },
                    y: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#fff' }, beginAtZero: true }
                }
            }
        });

        // تحليل الأداء
        const performanceMessage = document.getElementById('performanceMessage');
        const currentYear = grossProfitMargin[2];
        const previousYears = grossProfitMargin.slice(0, 2);
        const avg = previousYears.reduce((a, b) => a + b) / previousYears.length;

        if (currentYear > avg) {
            performanceMessage.innerHTML = 
                `<p style="color: #00FF7F; background-color: rgba(0, 255, 127, 0.2); padding: 10px; border-radius: 10px; font-weight: bold;">
                    Great! The gross profit margin is improving compared to the previous years.
                </p>`;
        } else {
            performanceMessage.innerHTML = 
                `<p style="color: #FF6347; background-color: rgba(255, 99, 71, 0.2); padding: 10px; border-radius: 10px; font-weight: bold;">
                    Caution! The gross profit margin is below the average of previous years.
                </p>`;
        }

        // بيانات الإيرادات والتكاليف
        const revenue2023 = parseFloat(localStorage.getItem('revenue')) || 0;
        const cogs2023 = parseFloat(localStorage.getItem('CostOfGoodSold')) || 0;

        // بيانات سنة 2022
        const revenue2022 = 5963933;
        const cogs2022 = 4647158;

        // حساب الفرق
        const profit2022 = revenue2022 - cogs2022;
        const profit2023 = revenue2023 - cogs2023;

        // حساب التغير بين 2022 و2023
        const revenueChange = revenue2023 - revenue2022;
        const cogsChange = cogs2023 - cogs2022;

        // إعداد الرسم البياني الثاني (الإيرادات - COGS)
        const ctxDifference = document.getElementById('differenceChart').getContext('2d');
        const differenceChart = new Chart(ctxDifference, {
            type: 'doughnut',
            data: {
                labels: ['2022', '2023'],
                datasets: [
                    {
                        label: 'Revenue',
                        data: [revenue2022, revenue2023],
                        backgroundColor: ['rgba(0, 195, 255, 0.6)', 'rgba(0, 123, 255, 0.6)'],
                        borderColor: '#00c3ff',
                        borderWidth: 1
                    },
                    {
                        label: 'Cost of Goods Sold (COGS)',
                        data: [cogs2022, cogs2023],
                        backgroundColor: ['rgba(255, 99, 71, 0.6)', 'rgba(255, 69, 0, 0.6)'],
                        borderColor: '#ff6347',
                        borderWidth: 1
                    },
                    {
                        label: 'Profit Difference',
                        data: [profit2022, profit2023],
                        backgroundColor: ['rgba(50, 205, 50, 0.6)', 'rgba(34, 139, 34, 0.6)'],
                        borderColor: '#32cd32',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: true, position: 'top', labels: { color: '#fff' } },
                    tooltip: {
                        backgroundColor: '#333',
                        titleColor: '#00c3ff',
                        bodyColor: '#fff',
                        borderWidth: 1,
                        borderColor: '#00c3ff'
                    }
                },
                scales: {
                    x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#fff' } },
                    y: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#fff' }, beginAtZero: true }
                }
            }
        });

        // تحليل الفرق
        const differenceMessage = document.getElementById('differenceMessage');
        let analysis = '';
        if (profit2023 > profit2022) {
            analysis = `<p style="color: #00FF7F; font-weight: bold;">The profit has increased in 2023 compared to 2022.`;
            if (revenueChange > 0 && cogsChange <= 0) {
                analysis += ` This improvement is driven by higher revenue while maintaining stable or reduced COGS, signaling efficient cost management and growth.</p>`;
            } else if (revenueChange > 0 && cogsChange > 0) {
                analysis += ` Although both revenue and COGS increased, the faster revenue growth offset the rising costs, resulting in higher profitability.</p>`;
            } else if (revenueChange <= 0 && cogsChange < 0) {
                analysis += ` The increase in profit is due to a significant reduction in COGS, even though revenue declined slightly.</p>`;
            }
        } else {
            analysis = `<p style="color: #FF6347; font-weight: bold;">The profit has decreased in 2023 compared to 2022.`; 
            if (revenueChange < 0 && cogsChange >= 0) {
                analysis += ` The primary cause is a drop in revenue, which was not matched by a corresponding reduction in COGS, leading to reduced profitability.</p>`;
            } else if (revenueChange >= 0 && cogsChange > 0) {
                analysis += ` While revenue saw some growth, it was outpaced by the increase in COGS, eroding the overall profit margin.</p>`;
            } else if (revenueChange < 0 && cogsChange < 0) {
                if (Math.abs(revenueChange) > Math.abs(cogsChange)) {
                    analysis += ` Both revenue and COGS decreased, but the decline in revenue was more pronounced, leading to reduced profit.</p>`;
                } else {
                    analysis += ` Despite a decrease in both revenue and COGS, the slower decline in COGS partially mitigated the profit reduction.</p>`;
                }
            } else {
                analysis += ` The reduction in profit is a result of other factors not directly related to revenue or COGS changes.</p>`;
            }
        }
        differenceMessage.innerHTML = analysis;
        // إعداد الرسم البياني الثالث (الفرق بين الإيرادات و COGS عبر السنوات)
        const ctxRevenueCOGS = document.getElementById('revenueCOGSChart').getContext('2d');
        const revenueCOGSChart = new Chart(ctxRevenueCOGS, {
            type: 'bar',
            data: {
                labels: ['2022', '2023'],
                datasets: [
                    {
                        label: 'Revenue',
                        data: [revenue2022, revenue2023],
                        backgroundColor: '#00c3ff',
                        borderColor: '#00a3d1',
                        borderWidth: 1
                    },
                    {
                        label: 'COGS',
                        data: [cogs2022, cogs2023],
                        backgroundColor: '#ff6347',
                        borderColor: '#ff4500',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: true, position: 'top', labels: { color: '#fff' } },
                    tooltip: {
                        backgroundColor: '#333',
                        titleColor: '#00c3ff',
                        bodyColor: '#fff',
                        borderWidth: 1,
                        borderColor: '#00c3ff'
                    }
                },
                scales: {
                    x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#fff' } },
                    y: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#fff' }, beginAtZero: true }
                }
            }
        });

        // تحليل الفرق بين الإيرادات وCOGS
        const revenueCOGSMessage = document.getElementById('revenueCOGSMessage');

// التأكد من تعريف المتغيرات
if (typeof revenue2023 === 'undefined' || typeof revenue2022 === 'undefined' ||
    typeof cogs2023 === 'undefined' || typeof cogs2022 === 'undefined') {
    revenueCOGSMessage.innerHTML = `
        <p style="color: #FF0000; font-weight: bold;">
            Error: Missing data. Please ensure all values are provided correctly.
        </p>`;
} else {
    // حساب التغيرات
    const revenueChange = revenue2023 - revenue2022;
    const cogsChange = cogs2023 - cogs2022;

    // تحليل الإيرادات والتكاليف
    let analysisCOGS = '';
    if (revenueChange > 0 && cogsChange > 0) {
        // الإيرادات زادت والتكاليف زادت
        analysisCOGS = `
            <p style="color: #00FF7F; font-weight: bold;">
                Revenue in 2023 increased by ${(revenueChange / revenue2022 * 100).toFixed(2)}%, 
                and COGS increased by ${(cogsChange / cogs2022 * 100).toFixed(2)}%.
            </p>`;
    } else if (revenueChange > 0 && cogsChange < 0) {
        // الإيرادات زادت والتكاليف انخفضت
        analysisCOGS = `
            <p style="color: #00FF7F; font-weight: bold;">
                Revenue in 2023 increased by ${(revenueChange / revenue2022 * 100).toFixed(2)}%, 
                while COGS decreased by ${(Math.abs(cogsChange) / cogs2022 * 100).toFixed(2)}%.
            </p>`;
    } else if (revenueChange < 0 && cogsChange > 0) {
        // الإيرادات انخفضت والتكاليف زادت
        analysisCOGS = `
            <p style="color: #FF6347; font-weight: bold;">
                Revenue in 2023 decreased by ${(Math.abs(revenueChange) / revenue2022 * 100).toFixed(2)}%, 
                but COGS increased by ${(cogsChange / cogs2022 * 100).toFixed(2)}%.
            </p>`;
    } else if (revenueChange < 0 && cogsChange < 0) {
        // الإيرادات انخفضت والتكاليف انخفضت
        analysisCOGS = `
            <p style="color: #FFA500; font-weight: bold;">
                Revenue in 2023 decreased by ${(Math.abs(revenueChange) / revenue2022 * 100).toFixed(2)}%, 
                and COGS also decreased by ${(Math.abs(cogsChange) / cogs2022 * 100).toFixed(2)}%.
            </p>`;
    } else {
        // حالة بدون تغيير أو غير متوقعة
        analysisCOGS = `
            <p style="color: #FFA500; font-weight: bold;">
                No significant changes detected in revenue or COGS for 2023 compared to 2022.
            </p>`;
    }

    // عرض التحليل في الصفحة
    revenueCOGSMessage.innerHTML = analysisCOGS;
}
// التعليق للمدير والمستثمر
const managerInvestorComments = document.getElementById('managerInvestorComments');

let decisionMessage = '';

if (revenueChange > 0 && cogsChange > 0) {
    // الإيرادات زادت والتكاليف زادت
    decisionMessage = `
        <p style="color: #FFA500; font-weight: bold;">
            For Investors: Despite the increase in revenue, the increase in COGS may indicate higher operational COGS. 
            This could put pressure on profitability, so investors should carefully monitor the company’s cost control and its impact on overall returns.
            <br><br>
            For Managers: Focus on controlling COGS to ensure that increased revenues are contributing to improved profitability. 
            Consider enhancing operational efficiencies or negotiating better supplier contracts to lower COGS.
        </p>`;
} else if (revenueChange > 0 && cogsChange < 0) {
    // الإيرادات زادت والتكاليف انخفضت
    decisionMessage = `
        <p style="color: #32CD32; font-weight: bold;">
            For Investors: This is a highly positive outcome! The company has increased its revenue while successfully reducing COGS, improving profitability. 
            This positions the company for strong future growth, and investors can expect improved returns.
            <br><br>
            For Managers: Excellent performance. Continue focusing on COGS management and consider reinvesting the savings into growth initiatives such as expanding market reach or enhancing product offerings.
        </p>`;
} else if (revenueChange < 0 && cogsChange > 0) {
    // الإيرادات انخفضت والتكاليف زادت
    decisionMessage = `
        <p style="color: #FF6347; font-weight: bold;">
            For Investors: This is a concerning scenario. The decrease in revenue coupled with an increase in COGS signals that the company is facing difficulties in both top-line growth and cost management. 
            Investors should remain cautious and monitor the company’s strategies to reverse these trends.
            <br><br>
            For Managers: Immediate action is needed. Focus on reducing operational COGS and finding new revenue streams. 
            Evaluate whether pricing adjustments, marketing improvements, or new product offerings are necessary to boost sales.
        </p>`;
} else if (revenueChange < 0 && cogsChange < 0) {
    // الإيرادات انخفضت والتكاليف انخفضت
    decisionMessage = `
        <p style="color: #FFA500; font-weight: bold;">
            For Investors: While COGS reductions are a positive sign, the decline in revenue is worrying. 
            Investors should carefully consider whether the company can regain its revenue growth and adapt to the changing market conditions.
            <br><br>
            For Managers: The priority should be addressing the decline in revenue. Consider increasing marketing efforts, diversifying product offerings, or exploring new market opportunities. 
            Reducing costs is important but may not be sufficient to drive profitability.
        </p>`;
} else {
    // حالة بدون تغيير أو غير متوقعة
    decisionMessage = `
        <p style="color: #FFD700; font-weight: bold;">
            For Investors: The company has maintained stable performance, but there is no evidence of growth. 
            Investors should be patient and await strategic initiatives that could drive future growth.
            <br><br>
            For Managers: Stability is good, but it's essential to look for ways to innovate and explore new growth opportunities. 
            Consider investing in research and development, expanding into new markets, or optimizing current operations for better efficiency.
        </p>`;
}

// عرض تعليق المدير والمستثمر في الصفحة
managerInvestorComments.innerHTML = decisionMessage;






        // تنزيل التقرير كملف PDF
        function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();

    // عنوان التقرير
    pdf.setFontSize(22);
    pdf.setFont("helvetica", "bold");
    pdf.text("Financial Dashboard Report", 14, 20);

    // إضافة فاصل
    pdf.setDrawColor(0);
    pdf.setLineWidth(0.5);
    pdf.line(10, 25, 200, 25); // رسم خط للفصل

    // العنوان للعام 2022
    pdf.setFontSize(16);
    pdf.setFont("helvetica", "normal");
    pdf.text("2022 Financial Overview", 14, 40);

    // جدول البيانات لعام 2022
    pdf.setFontSize(12);
    pdf.text(`Gross Profit Margin: ${grossProfitMargin[0]}%`, 14, 50);
    pdf.text(`Revenue: $${revenue2022.toLocaleString()}`, 14, 60);
    pdf.text(`COGS: $${cogs2022.toLocaleString()}`, 14, 70);

    // إضافة فاصل
    pdf.line(10, 75, 200, 75);

    // العنوان للعام 2023
    pdf.text("2023 Financial Overview", 14, 85);

    // جدول البيانات لعام 2023
    pdf.text(`Gross Profit Margin: ${grossProfitMargin[2]}%`, 14, 95);
    pdf.text(`Revenue: $${revenue2023.toLocaleString()}`, 14, 105);
    pdf.text(`COGS: $${cogs2023.toLocaleString()}`, 14, 115);

    // إضافة فاصل
    pdf.line(10, 120, 200, 120);

    // الفرق بين الأرباح في عام 2022 و2023
    pdf.setFontSize(14);
    pdf.setFont("helvetica", "bold");
    pdf.text(`Profit Difference (2022-2023): $${(profit2023 - profit2022).toLocaleString()}`, 14, 130);

    // إضافة مقارنة الإيرادات والتكاليف
    pdf.setFontSize(12);
    pdf.setFont("helvetica", "normal");
pdf.text("Revenue and COGS Analysis:", 14, 145);
pdf.text(`Revenue in 2023 ${revenueChange > 0 ? 'increased' : 'decreased'} by ${Math.abs(revenueChange / revenue2022 * 100).toFixed(2)}%,`, 14, 155);
pdf.text(`while COGS ${cogsChange < 0 ? 'decreased' : 'increased'} by ${(Math.abs(cogsChange) / cogs2022 * 100).toFixed(2)}%.`, 14, 165);


    // حفظ الملف
    pdf.save("financial_report.pdf");
}

    </script>
</body>
</html>
